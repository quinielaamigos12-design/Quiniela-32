<!doctype html>
<html lang="es">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Admin — Quiniela 32</title>
<link rel="stylesheet" href="style.css"/>
</head>
<body>
<div style="display:flex;">
  <div class="sidebar">
    <h2>Admin</h2>
    <p class="small-muted">Panel</p>
    <a href="admin.html" class="active">Panel</a>
    <a href="index.html">Salir</a>
  </div>
  <div class="container">
    <div class="header">
      <h3>Panel de administración</h3>
      <div class="small-muted">Admin: admin</div>
    </div>

    <div class="card">
      <h3>Jugadores (34)</h3>
      <div id="playersContainer" class="player-list"></div>
      <div style="margin-top:12px;">
        <input id="newPlayer" placeholder="Nombre - contraseña" />
        <button id="addBtn" class="btn">Añadir</button>
      </div>
      <div style="margin-top:12px;">
        <button id="exportBtn" class="btn">Exportar data.json</button>
        <input type="file" id="fileImport" />
        <button id="importBtn" class="btn">Importar</button>
      </div>
    </div>

  </div>
</div>
<script src="auth.js"></script>
<script>
async function loadPlayers(){
  let data = {};
  try{ data = await fetch('data.json',{cache:'no-store'}).then(r=>r.json()); }catch(e){ data = {players:[]}; }
  const container = document.getElementById('playersContainer'); container.innerHTML='';
  (data.players||[]).forEach((p,i)=>{
    const div = document.createElement('div'); div.className='player-item';
    div.innerHTML = '<div class="left"><div class="badge">'+(i+1)+'</div><div><strong>'+p.displayName+'</strong><div class="small-muted">'+p.name+'</div></div></div><div class="small-muted">'+(p.email||'')+'</div>';
    container.appendChild(div);
  });
}
document.addEventListener('DOMContentLoaded', loadPlayers);
document.getElementById('exportBtn').addEventListener('click', async ()=>{
  const data = await fetch('data.json',{cache:'no-store'}).then(r=>r.json()).catch(()=>({players:[]}));
  const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='data.json'; document.body.appendChild(a); a.click(); a.remove();
});
document.getElementById('addBtn').addEventListener('click', ()=>{
  const v = document.getElementById('newPlayer').value.trim();
  if(!v) return alert('Indica "nombre - contraseña"');
  const parts = v.split('-').map(s=>s.trim());
  if(parts.length<2) return alert('Formato: Nombre - contraseña');
  // load, push, download
  fetch('data.json',{cache:'no-store'}).then(r=>r.json()).then(data=>{
    data.players = data.players || [];
    data.players.push({name:parts[0], password:parts[1], displayName:parts[0], email:''});
    const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='data.json'; document.body.appendChild(a); a.click(); a.remove();
  }).catch(()=>alert('No se pudo leer data.json'));
});
</script>
</body>
</html>
